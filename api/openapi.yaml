openapi: 3.0.3

info:
  title: Notifique API
  description: A simple notification system.
  version: 0.1.0

servers:
  - url: http://localhost:8080
    description: Local development server

paths:

  /health:
    get:
      tags:
        - system
      summary: System health check
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: System status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  version:
                    type: string
                  uptime:
                    type: integer

  /notifications:
    get:
      tags:
        - notifications
      summary: Retrieve a page of notifications
      parameters:
        - $ref: "#/components/parameters/nextTokenParam"
        - $ref: "#/components/parameters/maxResultsParam"
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: A page of notifications has been retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PageResponseModel"
                properties:
                  data:
                    items:
                      $ref: "#/components/schemas/NotificationModel"
    post:
      tags:
        - notifications
      summary: Create a new notification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotificationRequestModel"
      responses:
        "204":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Notification created successfully and queued for delivery
        "400":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Invalid request payload
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error

  /notifications/{id}:
    get:
      tags:
        - notifications
      summary: Get notification details
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Notification details retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationModel"

    delete:
      tags:
        - notifications
      summary: Delete a notification record.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Notification deleted successfully
        "400":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: 
            The notification can't be deleted as its queued or sending.
        "500":
          description: Internal server error

  /notifications/{id}/cancel:
    post:
      tags:
        - notifications
      summary: Cancel a notification if its not being sent or sending.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "204":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Notification cancelled successfully
        "400":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: 
            The notification can't be cancelend as its already sent or sending.
        "500":
          description: Internal server error

  /notifications/templates:
    post:
      tags:
        - notifications
      summary: Create a notification template
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NotificationTemplateRequestModel"
      responses:
        "201":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Template created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationTemplateCreatedRespModel"
        "400":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Invalid template format
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error

    get:
      tags:
        - notifications
      summary: List notification templates
      parameters:
        - $ref: "#/components/parameters/nextTokenParam"
        - $ref: "#/components/parameters/maxResultsParam"
        - in: query
          name: templateName
          required: false
          schema:
            $ref: "#/components/schemas/NotificationTemplateName"
          description: filter templates based on name
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Templates retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PageResponseModel"
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/NotificationTemplateModel"

  /notifications/templates/{id}:
    get:
      tags:
        - notifications
      summary: Get notification template details
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            nullable: false
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Template details retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NotificationTemplateDetailsModel"
        "404":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Template not found
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error"

    delete:
      tags:
        - notifications
      summary: Delete a notification template
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
            format: uuid
            nullable: false
      responses:
        "204":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Template deleted successfully
        "404":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Template not found
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error

  /users/me/notifications:
    get:
      tags:
        - users
      summary: Retrieve a page of user notifications.
      parameters:
        - $ref: "#/components/parameters/nextTokenParam"
        - $ref: "#/components/parameters/maxResultsParam"
        - in: query
          name: topic
          required: false
          description: filter notifications based on topic
          schema:
            type: array
            items:
              type: string
              minLength: 1
          explode: true
          style: form
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: A page of notifications has been generated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PageResponseModel"
                properties:
                  data:
                    items:
                      $ref: "#/components/schemas/UserNotificationModel"

  /users/me/notifications/{id}:
    patch:
      tags:
        - users
      summary: Update notification read status
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Notification identifier
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Notification read status updated
        "404":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Notification not found
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error

  /users/me/notifications/config:
    get:
      tags:
        - users
      summary: Get user notification preferences
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: User notification config retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserConfigModel" 
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error
          
    put:
      tags:
        - users
      summary: Update user notification preferences
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserConfigModel"
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: User config updated successfully
        "400":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Invalid request payload
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error

  /users/me/notifications/live:
    get:
      tags:
        - users
      summary: Subscribe to live user notifications stream
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Server sent events stream established
          content:
            text/event-stream:
              schema:
                type: object
                properties:
                  data:
                    $ref: "#/components/schemas/UserNotificationModel"

  /distribution-lists:

    get:
      tags:
        - distribution-lists
      summary: Retrieve a page of distribution lists
      parameters:
        - $ref: "#/components/parameters/nextTokenParam" 
        - $ref: "#/components/parameters/maxResultsParam"
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: A page of distribution lists has been retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PageResponseModel"
                properties:
                  data:
                    items:
                      $ref: "#/components/schemas/DistributionListSummaryModel"
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error

    post:
      tags:
        - distribution-lists
      summary: Create a new distribution list
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DistributionListModel"
      responses:
        "201":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Distribution list created successfully
        "400":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Invalid request payload or distribution list already exists
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error

  /distribution-lists/{name}:
    delete:
      tags:
        - distribution-lists
      summary: Delete a distribution list
      parameters:
        - in: path
          name: name
          required: true
          schema:
            $ref: "#/components/schemas/DistributionListName"
          description: Name of the distribution list
      responses:
        "204":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Distribution list deleted successfully
        "400":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Invalid distribution list name
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error

  /distribution-lists/{name}/recipients:
    get:
      tags:
        - distribution-lists
      summary: Get recipients of a distribution list
      parameters:
        - in: path
          name: name
          required: true
          schema:
            $ref: "#/components/schemas/DistributionListName"
        - $ref: "#/components/parameters/nextTokenParam"
        - $ref: "#/components/parameters/maxResultsParam"
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Recipients retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PageResponseModel"
                properties:
                  data:
                    type: array
                    items:
                      type: string
        "404":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Distribution list not found
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error

    patch:
      tags:
        - distribution-lists
      summary: Add recipients to a distribution list
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
            minLength: 3
            maxLength: 120
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RecipientsModel"
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Recipients added successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DistributionListSummaryModel"
        "400":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Invalid request or distribution list not found
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error

    delete:
      tags:
        - distribution-lists
      summary: Remove recipients from a distribution list
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
            minLength: 3
            maxLength: 120
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RecipientsModel"
      responses:
        "200":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Recipients removed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DistributionListSummaryModel"
        "400":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Invalid request or distribution list not found
        "500":
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/schemas/RateLimitLimit'
            X-RateLimit-Remaining:  
              $ref: '#/components/schemas/RateLimitRemaining'
            X-RateLimit-Reset:
              $ref: '#/components/schemas/RateLimitReset'
          description: Internal server error

components:

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:

    nextTokenParam:
      in: query
      name: nextToken
      required: false
      schema:
        $ref: "#/components/schemas/TokenModel"
      description: the key of the last evaluated item of the page.

    maxResultsParam:
      in: query
      name: maxResults
      required: false
      schema:
        $ref: "#/components/schemas/MaxResultsModel"
      description: the maximum number of items to return on the page.

  schemas:

    RateLimitLimit:
      type: integer
      description: The maximum number of requests allowed in the time window
    RateLimitRemaining:
      type: integer
      description: The number of requests remaining in the current time window
    RateLimitReset:
      type: integer
      format: unix-timestamp
      description: The time at which the rate limit resets

    TokenModel:
      type: string
      format: byte
      nullable: true

    MaxResultsModel:
      type: integer
      minimum: 0

    PageResponseModel:
      type: object
      properties:
        nextToken:
          $ref: "#/components/schemas/TokenModel"
        prevToken:
          $ref: "#/components/schemas/TokenModel"
        resultCount:
          type: integer
          minimum: 0
          nullable: false
        data:
          type: array
          items:
            # This is a placeholder for the actual item type, which
            # will be replaced by `$ref` in the endpoints
            type: object
      required:
        - nextToken
        - prevToken
        - resultCount
        - data

    NotificationBase:
      type: object
      properties:
        topic:
          type: string
          minLength: 1
          maxLength: 120
          description: Topic category for the notification
        priority:
          type: string
          enum: [HIGH, MEDIUM, LOW]
          description: Priority level of the notification
        image:
          type: string
          format: uri
          nullable: true
          description: Optional URL to an image to include with the notification
        distributionList:
          $ref: "#/components/schemas/DistributionListName"
        recipients:
          type: array
          maxItems: 256
          uniqueItems: true
          description: List of recipient identifiers
          items:
            type: string
            minLength: 1
        channels:
          type: array
          uniqueItems: true
          description: Delivery channels to use
          items:
            type: string
            enum: [e-mail, sms, in-app]

    NotificationRequestModel:
      allOf:
        - $ref: "#/components/schemas/NotificationBase"
      type: object
      oneOf:
        - type: object
          properties:            
            template:
              type: object
              description: Template-based notification
              required:
                - name
                - variables
              properties:
                name:
                  type: string
                  description: Name of existing template
                  example: "maintenance-alert"
                variables:
                  type: object
                  description: Template variables
                  example:
                    service: "Payment API"
                    date: "2024-03-20"
                    startTime: "14:00"
                    endTime: "16:00"
        - type: object
          properties:
            content:
              type: object
              description: Direct content notification
              required:
                - title
                - contents
              properties:
                title:
                  type: string
                  minLength: 1
                  maxLength: 120
                contents:
                  type: string
                  minLength: 1
                  maxLength: 1024

    NotificationModel:
      allOf:
      - $ref: "#/components/schemas/NotificationBase"
      required:
      - id
      - topic
      - status
      - createdAt
      - createdBy
      properties:
        id:
          type: string
          format: uuid
          nullable: false
        status:
          type: string
          enum: [CREATED, QUEUED, SENT, SENDING, FAILED]
          description: Status of the notification
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the notification was created
        createdBy:
          type: string
          description: Identifier of the user who created the notification
        contentsType:
          type: string
          enum: [TEMPLATE, DIRECT]

    UserNotificationModel:
      type: object
      properties:
        id:
          type: string
          format: uuid
          nullable: false
        title:
          type: string
          nullable: false
          minLength: 1
        contents:
          type: string
          nullable: false
          minLength: 1
        createdAt:
          type: string
          format: date-time
          nullable: false
        image:
          type: string
          format: uri
          nullable: true
        readAt:
          type: string
          format: date-time
          nullable: true
        topic:
          type: string
          nullable: false
          minLength: 1

    ChannelConfig:
      type: object
      properties:
        optIn:
          type: boolean
          description: Whether the user has opted in for this notification channel
        snoozeUntil:
          type: string
          format: date-time
          nullable: true
          description: Timestamp until which notifications are snoozed

    UserConfigModel:
      type: object
      properties:
        emailConfig:
          $ref: "#/components/schemas/ChannelConfig"
        smsConfig:
          $ref: "#/components/schemas/ChannelConfig"
        pushConfig:
          $ref: "#/components/schemas/ChannelConfig"

    DistributionListName:
      type: string
      minLength: 3
      maxLength: 120
      pattern: "^[A-Za-z0-9$#@-_]+$"

    DistributionListModel:
      type: object
      properties:
        name:
          $ref: "#/components/schemas/DistributionListName"
        recipients:
          type: array
          maxItems: 256
          uniqueItems: true
          items:
            type: string
            minLength: 1
      required:
        - name
        - recipients

    DistributionListSummaryModel:
      type: object
      properties:
        name:
          type: string
        numberOfRecipients:
          type: integer
      required:
        - name
        - numberOfRecipients

    RecipientsModel:
      type: object
      properties:
        recipients:
          type: array
          maxItems: 256
          minItems: 1
          uniqueItems: true
          items:
            type: string
            minLength: 1
      required:
        - recipients
    
    NotificationTemplateName:
      type: string
      minLength: 1
      maxLength: 120

    NotificationTemplateBase:
      type: object
      required:
        - name
        - titleTemplate
        - contentTemplate
      properties:
        name:
          $ref: "#/components/schemas/NotificationTemplateName"
        titleTemplate:
          type: string
          minLength: 1
          maxLength: 120
          description: Title template with variables
        contentTemplate:
          type: string
          minLength: 1
          maxLength: 4096
          description: Content template, supports HTML
        variables:
          type: array
          items:
            $ref: "#/components/schemas/TemplateVariable"

    NotificationTemplateRequestModel:
      allOf:
        - $ref: "#/components/schemas/NotificationTemplateBase"
        - type: object
          properties:
            description:
              type: string
              maxLength: 256

    NotificationTemplateModel:
      type: object
      required:
        - id
        - name
        - description
      properties:
        id:
          type: string
          format: uuid
        name:
          $ref: "#/components/schemas/NotificationTemplateName"
        description:
          type: string
          maxLength: 256
          nullable: true

    NotificationTemplateCreatedRespModel:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          $ref: "#/components/schemas/NotificationTemplateName"
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - name
        - createdAt

    NotificationTemplateDetailsModel:
      allOf:
        - $ref: "#/components/schemas/NotificationTemplateBase"
        - $ref: "#/components/schemas/NotificationTemplateModel"

    TemplateVariable:
      type: object
      required:
        - name
        - type
      properties:
        name:
          type: string
          description: Variable name without braces
          maxLength: 120
        type:
          type: string
          enum: [string, date, time, number]
        required:
          type: boolean
          default: true
        validation:
          type: string
          description: Optional regex pattern

    UserNameTemplateVariable:
      type: string
      description:
          Use this value to substitute the user's name on a template
          when sending a notification with multiple recipients.
      example: "{{username}}"
